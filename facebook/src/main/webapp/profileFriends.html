<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<link rel="stylesheet" type="text/css" href="dist/css/bootstrap.min.css">
<link rel="stylesheet" type="text/css" href="dist/css/bootstrap-theme.min.css">
<link rel="stylesheet" href="css/chat.css">

<script src="dist/js/jquery-1.9.1.js"></script>
<script src="dist/js/bootstrap.js"></script>
<script src="dist/font/"></script>
<script src="js/navbar.js"></script>
<script src="js/profilephotoUpdate.js"></script>
<script src="js/chat.js"></script>

    
<title>Friends</title>


<style>
.fittodiv {
	height: 100%;
	width: 100%;
	object-fit: contain;
}

.inputstyle {
	outline: none;
	text-align: center;
}

.navbarstyle {
	display: block;
	width: 100%;
	color: white;
	height: 4em;
	border-radius: 0px;
	background-color: #444444;
	border-color: white;
	border-width: 0em;
}

.navbarstyle2 {
	background-color: #1F83E5;
	border: 0px;
}

button.ex1:hover, button.ex1:active {
	background-color: black;
	color: white;
}

li.ex1:hover, li.ex1:active {
	background-color: #145ea8;
}

.activepage2 {
	background-color: white;
}

.activepage {
	background-color: #2484e5;
}

.panel {
	overflow: auto;
}

.inputstyle {
	background-color: white;
	color: black;
	border: none;
	outline: none;
	text-align: left;
}

.padding-0 {
	padding-right: 0;
	padding-left: 0;
}

img {
	object-fit: cover;
}

.crop {
	width: 100%;
	height: 20em;
}

.edit {
	font-size: 0.9em;
}
</style>
</head>

<body style="background-color: #dfe3ee">
	<nav class="navbar navbarstyle2 navbar-fixed-top">
		<div class="container-fluid">
			<div class="navbar-header">
				<img class="img-responsive2" src="icon.png"
					style="height: 50px; width: auto;"> <a class="navbar-brand"
					href="#" style="color: black; font-weight: 500px;">Closer</a>
			</div>
			<form id="searchform" class="navbar-form navbar-left">
				<div class="input-group">
					<input type="Search" id="searchPeople" name="searchPeople"
						placeholder="Search..." class="form-control"
						style="min-width: 30em;" />
					<div class="input-group-btn">
						<button class="btn" type="submit">
							<span class="glyphicon glyphicon-search"></span>
						</button>
					</div>
				</div>
			</form>
			<ul class="nav navbar-nav navbar-right">
				<li><img src="" style="height: 50px; width: auto;"
					class="activepage" id="UserHomeImg"></img></li>
				<li class="activepage2"><a href="profile.html"
					style="color: blue;" id="UserHome"> </a></li>
				<li class="ex1"><a href="home.html"
					style="color: white;"><span class="glyphicon glyphicon-user"></span>
						Home</a></li>
				<li class="ex1"><a href="index.html" style="color: white;"><span
						class="glyphicon glyphicon-log-out"></span> Logout</a></li>
			</ul>
		</div>
	</nav>

	<div class="container-fluid" style="margin-top: 3em;">
		<div class="row">
			<div class="col-md-3 padding-0" style="position: relative;">
				<img src="" id="profilePhotoImg" class="img-responsive crop">
				<button
					style="position: absolute; bottom: 0; left: 0; background-color: grey; border: none;"
					type="button" class="btn btn-info" data-toggle="modal"
					data-target="#myModal2">
					<span class="glyphicon glyphicon-camera"></span>
				</button>

			</div>
			<div class="col-md-7 padding-0">
				<img src="a.jpg" class="img-responsive crop">
			</div>
		</div>
	</div>





	<div class="container-fluid">
		<ul class="nav nav-pills" style="margin-left: 24em;">
			<li><button onclick="window.location.href = 'profile.html';"
					class="btn ex1 navbarstyle"
					style="font-weight: bold; background: #dfe3ee; color: black;"
					id="Timeline">Timeline</button></li>
			<li><button
					onclick="window.location.href = 'profileAbout.html';"
					class="btn ex1 navbarstyle"
					style="font-weight: bold; background: #dfe3ee; color: black;"
					id="About">
					<span class="glyphicon glyphicon-user"></span> About
				</button></li>
			<li><button
					onclick="window.location.href = 'profilePhotos.html';"
					class="btn ex1 navbarstyle"
					style="font-weight: bold; background: #dfe3ee; color: black;">
					<span class="glyphicon glyphicon-camera"></span> Photos
				</button></li>
			<li><button
					onclick="window.location.href = 'profileFriends.html';"
					class="btn ex1 navbarstyle"
					style="font-weight: bold; background: white; color: black;">
					<span class="glyphicon glyphicon-glass"></span> Friends
				</button></li>
			<li><button
					onclick="window.location.href = 'PwdVerify.html';"
					class="btn ex1 navbarstyle"
					style="font-weight: bold; background: #dfe3ee; color: black;">
					<span class="glyphicon glyphicon-edit"></span> Change Password
				</button></li>
		</ul>
	</div>
	<div class="container-fluid">
		<div class="row">
			<div class="col-md-10">
				<div class="panel panel-default">
					<div class="panel-heading">
						<span class="glyphicon glyphicon-user"></span>&ensp;&ensp;<b>Friends</b>
					</div>
					<div class="panel-body">
						<div class="row">
							<div class="col-sm-6" id="imagesAll1"></div>
							<div class="col-sm-6" id="imagesAll2"></div>
						</div>
					</div>
				</div>
			</div>
			<div class="col-md-2 fixedChat" style="padding-right: 0em;">
				<div class="panel panel-default" id="chatPanel">
					<div class="panel-heading">
						<p>Chats</p>
					</div>
					<div class="panel-body" id="chatPanelBody"></div>
				</div>
			</div>
		</div>
	</div>


	<!-- Modal -->
	<div id="myModal2" class="modal fade" role="dialog">
		<div class="modal-dialog">

			<!-- Modal content-->
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal">&times;</button>
					<h4 class="modal-title">Upload Photo</h4>
				</div>

				<div class="modal-body">
					<div class="container-fluid row" style="display: inline;">
						<div class="col-md-8">
							<form id="myModal2Form" action="webapi/file/upload"
								method="post" enctype="multipart/form-data">
								<p id="uploadImage">
									Select a file : <input type="file" name="file" size="45"
										class="btn btn-success" />
								</p>
								<input type="text" name="Id" id="profilePhotoId" value=""
									style="display: none;"> <input type="submit"
									value="Upload It" class="btn btn-warning" />

							</form>
						</div>
						<div class="col-md-4">
							<img src="a.jpg" id="modalProfileImg"
								style="width: 100%; height: 10em;" onError="doSomething();" />
						</div>
					</div>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
				</div>
			</div>
		</div>
	</div>

	<!-- //////////////////////Suggest Modal///////////////////////// -->

	<div id="suggestModal" class="modal fade" role="dialog">
		<div class="modal-dialog">

			<!-- Modal content-->
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal">&times;</button>
					<h4 class="modal-title">Suggest Friends</h4>
				</div>
				<div class="modal-body" id="suggestModalBody"
					style="max-height: 30em; overflow-y: scroll"></div>
			</div>

		</div>
	</div>
</body>
</html>

<script>




var displaySuggestion=function(data){
	//console.log(data);
	var newPanel = document.createElement("DIV");
	newPanel.className = "panel panel-default";
	var newPanelBody = document.createElement("DIV");
	newPanelBody.className = "panel-body";
	{	var newDiv = document.createElement("DIV");
		newDiv.className = "col-md-3";
		var elem = document.createElement("img");
		elem.setAttribute('src',data['picturePath']);
		elem.className="fittodiv";
		//elem.setAttribute("height", "auto");
		//elem.setAttribute("width", "100em");
		newDiv.appendChild(elem);
		newPanelBody.appendChild(newDiv);
		//----//
		var newDiv = document.createElement("DIV");
		newDiv.className = "col-md-4";
		var h5 = document.createElement("H5");
		var h5text = document.createTextNode(data['name']); 
		h5.appendChild(h5text);
		newDiv.appendChild(h5);
		var h6 = document.createElement("H6");
		var h6text = document.createTextNode(data['email']); 
		h6.appendChild(h6text);
		newDiv.appendChild(h6);
		var h6 = document.createElement("H6");
		var h6text = document.createTextNode(data['dOB']); 
		h6.appendChild(h6text);
		newDiv.appendChild(h6);
		newPanelBody.appendChild(newDiv);
		//----//
		
		var newDiv = document.createElement("DIV");
		newDiv.className = "col-md-5";
		var btn = document.createElement("BUTTON");	// suggest
		btn.className="btn btn-primary pull-right edit"
		btn.id="suggest_"+data["id"];
		var t = document.createTextNode("Suggest");    
		btn.appendChild(t); 
		newDiv.appendChild(btn);

		
		//----//
		newPanelBody.appendChild(newDiv);
	}
	document.getElementById('suggestModalBody').appendChild(newPanelBody);
};


var displayPeople=function(data,numb){
	var newPanel = document.createElement("DIV");
	newPanel.className = "panel panel-default";
	var newPanelBody = document.createElement("DIV");
	newPanelBody.className = "panel-body";
	{	var newDiv = document.createElement("DIV");
		newDiv.className = "col-md-3";
		var elem = document.createElement("img");
		elem.setAttribute('src',data['profileImage']);
		elem.className="fittodiv";
		//elem.setAttribute("height", "auto");
		//elem.setAttribute("width", "100em");
		newDiv.appendChild(elem);
		newPanelBody.appendChild(newDiv);
		//----//
		var newDiv = document.createElement("DIV");
		newDiv.className = "col-md-4";
		
		var h5 = document.createElement("a");
		h5.id="friend_"+data["id"];
		h5.href="#";
		var h5text = document.createTextNode(data['name']); 
		h5.appendChild(h5text);
		newDiv.appendChild(h5);
		var h6 = document.createElement("H6");
		var h6text = document.createTextNode(data['email']); 
		h6.appendChild(h6text);
		newDiv.appendChild(h6);
		var h6 = document.createElement("H6");
		var h6text = document.createTextNode(data['DOB']); 
		h6.appendChild(h6text);
		newDiv.appendChild(h6);
		newPanelBody.appendChild(newDiv);
		//----//
		
		var newDiv = document.createElement("DIV");
		newDiv.className = "col-md-5";
		var btn = document.createElement("BUTTON");	// suggest
		btn.className="btn btn-info pull-right edit"
		btn.id="suggestFriend_"+data["id"];
		var t = document.createTextNode("Suggest Friends");    
		btn.appendChild(t); 
		newDiv.appendChild(btn);
		newDiv.appendChild(document.createElement("br"));
		newDiv.appendChild(document.createElement("br"));
		var btn = document.createElement("BUTTON");	// delete
		btn.className="btn btn-danger pull-right edit"
		btn.id="unfriend_"+data["id"];
		var t = document.createTextNode("Unfriend");    
		btn.appendChild(t); 
		newDiv.appendChild(btn);

		
		//----//
		newPanelBody.appendChild(newDiv);
	}
	newPanel.appendChild(newPanelBody);
	if(numb%2==0)
	document.getElementById('imagesAll1').appendChild(newPanel);
	if(numb%2==1)
		document.getElementById('imagesAll2').appendChild(newPanel);
	//console.log(data);
	
};

	/*function load_home() {
	 document.getElementById("section1").innerHTML='<object type="text/html" data="home.html" style="width:100%; height: 100%;" ></object>';
	}*/
	//var friends=document.getElementById("section2");
	//var photos=document.getElementById("section3");
	//-----------------------------------------------------------------//
	//------------------------------------------------------------//
	$('#myModal2').on('shown.bs.modal', function(e) {
		document.getElementById("profilePhotoId").value = sessionStorage.id;
	})
	//------------------------------------------------------------//
	//-----------------------------------------------------------------//
	$(".btn").mouseup(function() {
		$(this).blur();
	})
	//-----------------------------------------------------------//
	$.ajax({
		type : "post",
		// make sure you respect the same origin policy with this url:
		// http://en.wikipedia.org/wiki/Same_origin_policy
		//dataType: "text",
		url : "webapi/profile/"
				+ sessionStorage.id,

		success : function(msg) {
			//console.log(msg);
			document.getElementById("profilePhotoImg").src = msg.profileImage;
		}
	});
	//-----------------------------------/
	$.ajax({
		type : "get",
		// make sure you respect the same origin policy with this url:
		// http://en.wikipedia.org/wiki/Same_origin_policy
		//dataType: "text",
		url : "webapi/friends/"
				+ sessionStorage.id,

		success : function(res) {
			//console.log(res);
			var len=res.length;
			for (i = 0; i < len; i++) {
				displayPeople(res[i],i);
			}
		},
		complete:function(){
			
			$('a[id^="friend_"]').click(function(){
				sessionStorage.friendid=$(this).attr('id').split("_")[1];
				//console.log(($(this).attr('id')).split("_")[1]);
				window.location.href="profile_other.html";
			
			});
			$('button[id^="unfriend_"]').click(function(){
				var bid=$(this).attr('id');
				$.ajax({
					type:"post",
					url: "webapi/friendRequest/unfriend?&id1="+bid.split("_")[1]+"&id2="+sessionStorage.id,
					success: function(data){
						//console.log("-----"+data+"");
						if(data=="true"){
							//console.log($('button[id='+bid+']').attr('id'));
							$('button[id='+bid+']').html("Unfriended")
							.addClass("btn-warning")
							.prop('disabled',true);
							//$('button[id=unfriend_'+bid.split("_")[1]+']').remove();
							
						}
					}
				});
			});
			
			$('button[id^="suggestFriend_"]').click(function(){
				var bid1=$(this).attr('id').split("_")[1];
				$('#suggestModalBody').html(' ');
				//console.log(sessionStorage.id);
				$.ajax({
					type:"get",
					url: "webapi/friendRequest/suggestion?from="+sessionStorage.id+"&to="+bid1,
					async:false,
					success: function(data){
						for(i=0;i<data.length;++i){
							//console.log(data[i]);
							displaySuggestion(data[i]);
						}
					},
					complete:function(){
						$("#suggestModal").modal();
						$('button[id^="suggest_"]').click(function(){
						var bid2=$(this).attr('id').split("_")[1];
						//console.log($(this).attr('id'));
							$.ajax({
								type:"put",
								url: "webapi/friendRequest/suggest?&from="+sessionStorage.id+"&to="+bid1+"&this="+bid2,
								success: function(data){
									//console.log("-----"+data+"");
									if(data=="true"){
										//console.log($('button[id=suggest_'+bid2+']').attr('id'));
										$('button[id=suggest_'+bid2+']').html("Suggested")
										.prop('disabled',true);
										//$('button[id=unfriend_'+bid.split("_")[1]+']').remove();
										
									}
								}
							});
						});
						
					}
				});
			});
		}
	});
	//-------------------------------------/
</script>